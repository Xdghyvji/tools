<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blog - Digital Services Hub</title>
    
    <!-- Core SEO & Wikipedia-Inspired Tags -->
    <meta name="description" content="Explore the latest insights, tutorials, and updates on digital marketing, AI tools, and SEO strategies.">
    <meta name="generator" content="DigitalServicesHub v1.0">
    <meta name="referrer" content="origin-when-cross-origin">
    <meta name="robots" content="index, follow, max-image-preview:standard">
    <meta name="format-detection" content="telephone=no">
    
    <!-- Open Graph / Social -->
    <meta property="og:title" content="Blog - Digital Services Hub">
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="Digital Services Hub">
    <meta property="og:locale" content="en_US">
    
    <!-- Canonical (Dynamic) -->
    <link rel="canonical" href="https://digitalserviceshub.online/blog.html">
    <link rel="license" href="https://digitalserviceshub.online/terms.html">
    
    <!-- Performance & Preconnect -->
    <link rel="preconnect" href="https://cdn.tailwindcss.com">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://www.gstatic.com">
    <link rel="dns-prefetch" href="https://firestore.googleapis.com">
    
    <!-- Icons -->
    <link rel="icon" type="image/png" href="assets/img/digitalserviceshub.png">
    <link rel="apple-touch-icon" href="assets/img/digitalserviceshub.png">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        brand: { 50: '#f0f9ff', 100: '#e0f2fe', 200: '#bae6fd', 300: '#7dd3fc', 400: '#38bdf8', 500: '#0ea5e9', 600: '#0284c7', 700: '#0369a1', 800: '#075985', 900: '#0c4a6e' }
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        display: ['Plus Jakarta Sans', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    
    <!-- Fonts & Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@500;600;700;800&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        body { font-family: 'Inter', sans-serif; }
        h1, h2, h3, h4, h5, h6 { font-family: 'Plus Jakarta Sans', sans-serif; }
        
        /* Typography for Blog Content */
        .prose h1 { font-size: 2.25em; font-weight: 800; margin-bottom: 0.5em; line-height: 1.2; color: #0f172a; }
        .prose h2 { font-size: 1.875em; font-weight: 700; margin-top: 2em; margin-bottom: 1em; color: #0f172a; }
        .prose h3 { font-size: 1.5em; font-weight: 600; margin-top: 1.5em; margin-bottom: 0.75em; color: #334155; }
        .prose p { margin-bottom: 1.25em; line-height: 1.8; color: #334155; font-size: 1.125rem; }
        .prose ul { list-style-type: disc; padding-left: 1.5em; margin-bottom: 1.25em; color: #334155; }
        .prose ol { list-style-type: decimal; padding-left: 1.5em; margin-bottom: 1.25em; color: #334155; }
        .prose a { color: #2563eb; text-decoration: underline; text-underline-offset: 4px; font-weight: 500; }
        .prose a:hover { color: #1d4ed8; }
        .prose img { border-radius: 0.75rem; margin: 2rem 0; width: 100%; height: auto; box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1); }
        .prose blockquote { border-left: 4px solid #3b82f6; padding-left: 1.5rem; font-style: italic; color: #475569; background: #eff6ff; padding: 1.5rem; border-radius: 0 0.5rem 0.5rem 0; margin-bottom: 2rem; }
        
        .line-clamp-2 { display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 flex flex-col min-h-screen">

    <!-- Header Injection Target -->
    <div id="main-header" class="sticky top-0 z-50"></div>

    <!-- Main Content -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 md:py-12 flex-grow w-full">
        
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8 lg:gap-12">
            
            <!-- LEFT COLUMN: Main Content (8 Columns) -->
            <main class="lg:col-span-8 w-full" id="main-content-area">
                
                <!-- Loading State -->
                <div id="loading-state" class="flex flex-col items-center justify-center py-20">
                    <i data-lucide="loader-2" class="w-10 h-10 text-brand-600 animate-spin mb-4"></i>
                    <p class="text-slate-500 font-medium">Loading content...</p>
                </div>

                <!-- 1. Blog List View -->
                <div id="blog-list-view" class="hidden">
                    <div class="mb-10 text-center md:text-left">
                        <h1 class="text-4xl md:text-5xl font-extrabold text-slate-900 mb-4 tracking-tight leading-tight">
                            Latest <span class="text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-indigo-600">Insights</span>
                        </h1>
                        <p class="text-lg text-slate-600 max-w-2xl">
                            Expert strategies, tutorials, and updates on digital marketing, AI tools, and SEO.
                        </p>
                    </div>

                    <div id="posts-grid" class="space-y-8">
                        <!-- Posts injected here -->
                    </div>

                    <!-- Pagination -->
                    <div id="pagination-controls" class="mt-12 flex justify-center items-center gap-2 hidden">
                        <!-- Pagination injected here -->
                    </div>
                </div>

                <!-- 2. Single Post View -->
                <div id="single-post-view" class="hidden">
                    <article class="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden mb-8">
                        <!-- Image Container -->
                        <div class="w-full h-64 md:h-96 bg-slate-100 relative overflow-hidden group">
                            <img id="post-image" src="" class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-105" alt="">
                        </div>
                        
                        <div class="p-6 md:p-10">
                            <!-- Meta -->
                            <div class="flex flex-wrap items-center gap-4 text-sm text-slate-500 mb-6">
                                <span id="post-category" class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full font-bold text-xs uppercase tracking-wider">
                                    General
                                </span>
                                <div class="flex items-center gap-2">
                                    <i data-lucide="calendar" class="w-4 h-4"></i>
                                    <span id="post-date">...</span>
                                </div>
                            </div>

                            <!-- Title -->
                            <h1 id="post-title" class="text-3xl md:text-4xl lg:text-5xl font-extrabold text-slate-900 mb-8 leading-tight">
                                <!-- Title Here -->
                            </h1>

                            <!-- Content -->
                            <div id="post-content" class="prose prose-lg max-w-none prose-headings:font-display">
                                <!-- Content Here -->
                            </div>
                            
                            <!-- Author Box -->
                            <div class="mt-12 pt-8 border-t border-slate-100 flex items-center gap-4">
                                <div class="w-14 h-14 rounded-full bg-slate-200 flex items-center justify-center text-xl font-bold text-slate-600 uppercase" id="author-avatar">
                                    A
                                </div>
                                <div>
                                    <p class="text-xs text-slate-400 uppercase font-bold tracking-wider mb-1">Written By</p>
                                    <a href="#" class="text-lg font-bold text-slate-900 hover:text-blue-600 transition-colors" id="post-author">
                                        Admin
                                    </a>
                                    <p class="text-sm text-slate-500">Content Creator</p>
                                </div>
                            </div>
                        </div>
                    </article>

                    <!-- COMMENTS SECTION -->
                    <div class="bg-white rounded-2xl shadow-sm border border-slate-200 p-6 md:p-10">
                        <div class="flex items-center justify-between mb-8">
                            <h3 class="text-2xl font-bold text-slate-900">Discussion</h3>
                            <span class="text-sm text-slate-500" id="comment-count">0 Comments</span>
                        </div>
                        
                        <!-- Comment Form -->
                        <form id="comment-form" class="mb-10 bg-slate-50 p-6 rounded-xl border border-slate-100">
                            <h4 class="font-bold text-slate-700 mb-4 text-sm uppercase tracking-wide">Leave a Reply</h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                <input type="text" id="comment-name" placeholder="Name *" class="w-full bg-white border border-slate-200 rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-shadow" required>
                                <input type="email" id="comment-email" placeholder="Email (Optional)" class="w-full bg-white border border-slate-200 rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-shadow">
                            </div>
                            <textarea id="comment-body" rows="3" placeholder="Join the discussion..." class="w-full bg-white border border-slate-200 rounded-lg px-4 py-3 mb-4 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-shadow" required></textarea>
                            <button type="submit" id="submit-comment-btn" class="bg-blue-600 text-white px-6 py-2.5 rounded-lg font-bold hover:bg-blue-700 transition-all shadow-lg shadow-blue-500/30 flex items-center gap-2">
                                <span>Post Comment</span>
                                <i data-lucide="send" class="w-4 h-4"></i>
                            </button>
                        </form>

                        <!-- Comments List -->
                        <div id="comments-list" class="space-y-8">
                            <!-- Injected via JS -->
                            <div class="text-center py-4 text-slate-400 italic" id="no-comments-msg">Be the first to share your thoughts!</div>
                        </div>
                    </div>
                </div>

                <!-- Not Found State -->
                <div id="not-found-state" class="hidden flex flex-col items-center justify-center py-20 text-center">
                     <div class="w-20 h-20 bg-slate-100 rounded-full flex items-center justify-center mb-6">
                        <i data-lucide="file-question" class="w-10 h-10 text-slate-400"></i>
                    </div>
                    <h2 class="text-2xl font-bold text-slate-900 mb-2">Article Not Found</h2>
                    <p class="text-slate-500 mb-8 max-w-md">The article you are looking for might have been removed or is temporarily unavailable.</p>
                    <a href="/blog.html" class="bg-blue-600 text-white px-6 py-3 rounded-lg font-bold hover:bg-blue-700 transition-colors">
                        Browse All Articles
                    </a>
                </div>

            </main>

            <!-- RIGHT COLUMN: Sidebar (4 Columns) -->
            <aside class="lg:col-span-4 w-full space-y-8">
                
                <!-- Search Widget -->
                <div class="bg-white rounded-xl border border-slate-200 p-6 shadow-sm">
                    <h4 class="font-bold text-slate-900 mb-4 flex items-center gap-2 font-display">
                        <i data-lucide="search" class="w-4 h-4 text-blue-500"></i> Search
                    </h4>
                    <div class="relative">
                        <input type="text" id="search-input" placeholder="Search articles..." class="w-full bg-slate-50 border border-slate-200 rounded-lg pl-10 pr-4 py-2.5 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:bg-white transition-all">
                        <i data-lucide="search" class="w-4 h-4 text-slate-400 absolute left-3 top-3"></i>
                    </div>
                </div>

                <!-- Trending Widget -->
                <div class="bg-white rounded-xl border border-slate-200 p-6 shadow-sm">
                    <h4 class="font-bold text-slate-900 mb-4 flex items-center gap-2 font-display">
                        <i data-lucide="zap" class="w-4 h-4 text-amber-500"></i> Trending Now
                    </h4>
                    <div id="popular-posts-list" class="space-y-5">
                        <div class="animate-pulse space-y-4">
                            <div class="h-16 bg-slate-100 rounded-lg"></div>
                            <div class="h-16 bg-slate-100 rounded-lg"></div>
                            <div class="h-16 bg-slate-100 rounded-lg"></div>
                        </div>
                    </div>
                </div>

                <!-- Categories -->
                <div class="bg-white rounded-xl border border-slate-200 p-6 shadow-sm">
                     <h4 class="font-bold text-slate-900 mb-4 flex items-center gap-2 font-display">
                        <i data-lucide="tag" class="w-4 h-4 text-emerald-500"></i> Categories
                    </h4>
                     <div class="flex flex-wrap gap-2" id="categories-list">
                        <span class="px-3 py-1 bg-slate-100 text-slate-600 rounded-full text-xs font-bold hover:bg-slate-200 cursor-pointer transition-colors">AI Tools</span>
                        <span class="px-3 py-1 bg-slate-100 text-slate-600 rounded-full text-xs font-bold hover:bg-slate-200 cursor-pointer transition-colors">Marketing</span>
                        <span class="px-3 py-1 bg-slate-100 text-slate-600 rounded-full text-xs font-bold hover:bg-slate-200 cursor-pointer transition-colors">SEO</span>
                        <span class="px-3 py-1 bg-slate-100 text-slate-600 rounded-full text-xs font-bold hover:bg-slate-200 cursor-pointer transition-colors">Business</span>
                        <span class="px-3 py-1 bg-slate-100 text-slate-600 rounded-full text-xs font-bold hover:bg-slate-200 cursor-pointer transition-colors">Social Media</span>
                     </div>
                </div>

            </aside>
        </div>
    </div>

    <!-- Footer Injection Target -->
    <div id="main-footer"></div>

    <!-- Logic -->
    <script type="module">
        import { db, appId } from './assets/js/shared.js';
        import { collection, getDocs, query, where, limit, addDoc, serverTimestamp, onSnapshot } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Inject Default Header/Footer if module fails (Fallback)
        const renderHeader = () => `
            <nav class="bg-white/80 backdrop-blur-md border-b border-slate-200">
                <div class="max-w-7xl mx-auto px-4 h-16 flex justify-between items-center">
                    <a href="/" class="flex items-center gap-2 font-display font-bold text-xl text-slate-900">
                        <div class="bg-blue-600 text-white p-1.5 rounded-lg"><i data-lucide="zap" class="w-5 h-5"></i></div>
                        DigitalServicesHub
                    </a>
                    <div class="hidden md:flex gap-6 text-sm font-medium text-slate-600">
                        <a href="/" class="hover:text-blue-600">Home</a>
                        <a href="/blog.html" class="text-blue-600">Blog</a>
                        <a href="/tools.html" class="hover:text-blue-600">Tools</a>
                        <a href="/contact.html" class="hover:text-blue-600">Contact</a>
                    </div>
                </div>
            </nav>
        `;
        const renderFooter = () => `
            <footer class="bg-white border-t border-slate-200 py-12 mt-auto">
                <div class="max-w-7xl mx-auto px-4 text-center text-slate-500 text-sm">
                    © 2026 Digital Services Hub. All rights reserved.
                </div>
            </footer>
        `;
        document.getElementById('main-header').innerHTML = renderHeader();
        document.getElementById('main-footer').innerHTML = renderFooter();

        // --- CORE VARIABLES ---
        const loading = document.getElementById('loading-state');
        const listView = document.getElementById('blog-list-view');
        const singleView = document.getElementById('single-post-view');
        const notFound = document.getElementById('not-found-state');
        const postsGrid = document.getElementById('posts-grid');
        const popularList = document.getElementById('popular-posts-list');
        const paginationContainer = document.getElementById('pagination-controls');
        
        let allPosts = [];
        let filteredPosts = [];
        let currentPage = 1;
        const POSTS_PER_PAGE = 20;

        // --- INIT ---
        async function init() {
            const slug = getSlug();
            
            // Initial Load
            if (slug) {
                await loadSinglePost(slug);
            } else {
                await loadPostList();
            }
            
            loadSidebar(); // Runs parallel
            lucide.createIcons();
        }

        function getSlug() {
            const path = window.location.pathname;
            if (path.startsWith('/blog/') && path.length > 6) return path.split('/blog/')[1].replace('.html', '');
            const params = new URLSearchParams(window.location.search);
            return params.get('p');
        }

        // --- LIST VIEW ---
        async function loadPostList() {
            try {
                const snap = await getDocs(collection(db, 'artifacts', appId, 'public', 'data', 'posts'));
                const raw = [];
                snap.forEach(doc => raw.push({ id: doc.id, ...doc.data() }));
                
                allPosts = raw.filter(p => p.published !== false).sort((a,b) => new Date(b.date) - new Date(a.date));
                filteredPosts = [...allPosts];
                
                renderPaginatedList();
                loading.classList.add('hidden');
                listView.classList.remove('hidden');
            } catch(e) { console.error(e); }
        }

        function renderPaginatedList() {
            const total = Math.ceil(filteredPosts.length / POSTS_PER_PAGE);
            if(currentPage > total) currentPage = total || 1;
            
            const start = (currentPage - 1) * POSTS_PER_PAGE;
            const slice = filteredPosts.slice(start, start + POSTS_PER_PAGE);
            
            if(slice.length === 0) {
                postsGrid.innerHTML = `<div class="text-center py-10 text-slate-500">No posts found.</div>`;
            } else {
                postsGrid.innerHTML = slice.map(p => `
                    <div class="flex flex-col md:flex-row gap-6 bg-white border border-slate-200 rounded-2xl overflow-hidden hover:shadow-lg hover:shadow-blue-500/5 transition-all duration-300 group">
                        <a href="/blog/${p.slug || p.id}" class="w-full md:w-5/12 aspect-video md:aspect-auto bg-slate-100 relative overflow-hidden shrink-0">
                            ${p.image ? `<img src="${p.image}" class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-105">` : ''}
                        </a>
                        <div class="p-6 md:py-8 flex flex-col justify-center flex-grow">
                            <div class="flex items-center gap-3 mb-3 text-xs font-bold uppercase tracking-wide text-slate-400">
                                <span class="text-blue-600">${p.category || 'Article'}</span>
                                <span>•</span>
                                <span>${p.date || 'Recent'}</span>
                            </div>
                            <h3 class="text-xl font-bold font-display text-slate-900 mb-3 group-hover:text-blue-600 transition-colors">
                                <a href="/blog/${p.slug || p.id}">${p.title}</a>
                            </h3>
                            <p class="text-slate-500 text-sm leading-relaxed line-clamp-2 mb-6">
                                ${p.content ? p.content.replace(/<[^>]*>?/gm, '').substring(0, 150) + '...' : 'Read article...'}
                            </p>
                            <a href="/blog/${p.slug || p.id}" class="text-sm font-bold text-slate-900 hover:text-blue-600 inline-flex items-center">
                                Read Article <i data-lucide="arrow-right" class="w-4 h-4 ml-1"></i>
                            </a>
                        </div>
                    </div>
                `).join('');
            }
            renderPagination(total);
            lucide.createIcons();
            window.scrollTo({top:0, behavior:'smooth'});
        }

        function renderPagination(total) {
            if(total <= 1) { paginationContainer.classList.add('hidden'); return; }
            let html = '';
            for(let i=1; i<=total; i++) {
                html += `<button onclick="window.setPage(${i})" class="w-10 h-10 rounded-lg text-sm font-bold border transition-colors ${i === currentPage ? 'bg-blue-600 text-white border-blue-600' : 'bg-white text-slate-600 border-slate-200 hover:bg-slate-50'}">${i}</button>`;
            }
            paginationContainer.innerHTML = html;
            paginationContainer.classList.remove('hidden');
        }
        window.setPage = (p) => { currentPage = p; renderPaginatedList(); }

        // --- SINGLE POST & COMMENTS ---
        async function loadSinglePost(slug) {
            try {
                let q = query(collection(db, 'artifacts', appId, 'public', 'data', 'posts'), where('slug', '==', slug), limit(1));
                let snap = await getDocs(q);
                
                if(!snap.empty) {
                    const post = snap.docs[0].data();
                    renderPost(post);
                    updateSEO(post);
                    loadComments(slug); // Load comments for this slug
                    
                    // Attach Comment Submit Listener
                    document.getElementById('comment-form').onsubmit = (e) => submitComment(e, slug);
                    
                    loading.classList.add('hidden');
                    singleView.classList.remove('hidden');
                } else {
                    loading.classList.add('hidden');
                    notFound.classList.remove('hidden');
                }
            } catch(e) { console.error(e); }
        }

        function renderPost(post) {
            document.getElementById('post-title').innerText = post.title;
            document.getElementById('post-category').innerText = post.category || 'General';
            document.getElementById('post-date').innerText = post.date;
            document.getElementById('post-author').innerText = post.author || 'Admin';
            document.getElementById('author-avatar').innerText = (post.author || 'A').charAt(0);
            
            const img = document.getElementById('post-image');
            if(post.image) img.src = post.image; else img.parentElement.style.display = 'none';
            document.getElementById('post-content').innerHTML = post.content || '';
        }

        // --- COMMENTS LOGIC ---
        function loadComments(slug) {
            const list = document.getElementById('comments-list');
            const countEl = document.getElementById('comment-count');
            const noMsg = document.getElementById('no-comments-msg');
            
            const q = query(
                collection(db, 'artifacts', appId, 'public', 'data', 'comments'), 
                where('postSlug', '==', slug)
                // orderBy requires index, doing client sort for now
            );

            onSnapshot(q, (snap) => {
                const comments = [];
                snap.forEach(d => comments.push(d.data()));
                comments.sort((a,b) => (b.createdAt?.seconds || 0) - (a.createdAt?.seconds || 0));
                
                countEl.innerText = `${comments.length} Comments`;
                
                if(comments.length === 0) {
                    noMsg.style.display = 'block';
                    list.innerHTML = '';
                    list.appendChild(noMsg);
                } else {
                    noMsg.style.display = 'none';
                    list.innerHTML = comments.map(c => `
                        <div class="flex gap-4">
                            <div class="w-10 h-10 rounded-full bg-gradient-to-br from-blue-500 to-indigo-600 text-white flex items-center justify-center font-bold text-sm shrink-0">
                                ${c.name.charAt(0).toUpperCase()}
                            </div>
                            <div>
                                <div class="flex items-center gap-2 mb-1">
                                    <h5 class="font-bold text-slate-900 text-sm">${c.name}</h5>
                                    <span class="text-xs text-slate-400">${new Date(c.createdAt?.seconds * 1000 || Date.now()).toLocaleDateString()}</span>
                                </div>
                                <p class="text-slate-600 text-sm leading-relaxed">${c.text}</p>
                            </div>
                        </div>
                    `).join('');
                }
            });
        }

        async function submitComment(e, slug) {
            e.preventDefault();
            const btn = document.getElementById('submit-comment-btn');
            const name = document.getElementById('comment-name').value;
            const email = document.getElementById('comment-email').value;
            const text = document.getElementById('comment-body').value;
            
            if(!name || !text) return;

            const originalBtn = btn.innerHTML;
            btn.innerHTML = `<i data-lucide="loader-2" class="w-4 h-4 animate-spin"></i> Posting...`;
            btn.disabled = true;

            try {
                await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'comments'), {
                    postSlug: slug,
                    name,
                    email, // Optional, maybe don't display it publicly
                    text,
                    createdAt: serverTimestamp()
                });
                e.target.reset();
                alert("Comment posted!");
            } catch(err) {
                alert("Failed to post comment.");
                console.error(err);
            } finally {
                btn.innerHTML = originalBtn;
                btn.disabled = false;
                lucide.createIcons();
            }
        }

        // --- SEO & SIDEBAR ---
        function updateSEO(post) {
            const seo = post.seo || {};
            
            // 1. Title
            document.title = seo.title || post.title;
            
            // 2. Meta Helper
            const setMeta = (name, content) => {
                let tag = document.querySelector(`meta[name="${name}"]`);
                if (!tag) {
                    tag = document.createElement('meta');
                    tag.name = name;
                    document.head.appendChild(tag);
                }
                tag.content = content || '';
            };

            // 3. Update Canonical Link
            let canonical = document.querySelector('link[rel="canonical"]');
            if (!canonical) {
                canonical = document.createElement('link');
                canonical.rel = 'canonical';
                document.head.appendChild(canonical);
            }
            // Use user-defined canonical or default to current URL
            canonical.href = seo.canonical || window.location.href;

            // 4. Update Meta Description & Keywords
            const fallbackDesc = post.content ? post.content.replace(/<[^>]*>?/gm, '').substring(0, 160) + '...' : '';
            setMeta('description', seo.description || fallbackDesc);
            if (seo.keywords) setMeta('keywords', seo.keywords);

            // 5. Open Graph Updates
            let ogTitle = document.querySelector('meta[property="og:title"]');
            if(ogTitle) ogTitle.content = seo.title || post.title;
            
            let ogUrl = document.querySelector('meta[property="og:url"]');
            if(!ogUrl) {
                ogUrl = document.createElement('meta');
                ogUrl.setAttribute('property', 'og:url');
                document.head.appendChild(ogUrl);
            }
            ogUrl.content = window.location.href;

            // 6. Local SEO Schema (Organization) + Article Schema
            const localSeoSchema = {
                "@context": "https://schema.org",
                "@type": "Organization",
                "name": "Digital Services Hub",
                "url": "https://digitalserviceshub.online",
                "logo": "https://digitalserviceshub.online/assets/img/digitalserviceshub.png",
                "sameAs": [
                    "https://twitter.com/digitalserviceshub", 
                    "https://facebook.com/digitalserviceshub"
                ]
            };

            const articleSchema = {
                "@context": "https://schema.org",
                "@type": seo.schema || "Article",
                "headline": post.title,
                "image": post.image ? [post.image] : [],
                "datePublished": post.date ? new Date(post.date).toISOString() : new Date().toISOString(),
                "author": {
                    "@type": "Person",
                    "name": post.author || "Admin"
                }
            };
            
            // Clean up old JSON-LD scripts
            document.querySelectorAll('script[type="application/ld+json"]').forEach(s => s.remove());

            // Inject New Scripts
            const script1 = document.createElement('script');
            script1.type = 'application/ld+json';
            script1.textContent = JSON.stringify(localSeoSchema);
            document.head.appendChild(script1);

            const script2 = document.createElement('script');
            script2.type = 'application/ld+json';
            script2.textContent = JSON.stringify(articleSchema);
            document.head.appendChild(script2);
        }

        async function loadSidebar() {
             // Simple logic: fetch all, shuffle, pick 4.
             // In production, use a specific 'featured' flag or orderBy date desc limit 5
             if(allPosts.length === 0) {
                 try {
                     const s = await getDocs(collection(db, 'artifacts', appId, 'public', 'data', 'posts'));
                     s.forEach(d => allPosts.push({id:d.id, ...d.data()}));
                 } catch(e) {}
             }
             
             const shuffled = [...allPosts].filter(p => p.published !== false).sort(()=>0.5-Math.random()).slice(0,5);
             popularList.innerHTML = shuffled.map(p => `
                <a href="/blog/${p.slug || p.id}" class="flex gap-4 group items-start">
                    <div class="w-16 h-16 rounded-lg bg-slate-100 overflow-hidden shrink-0 border border-slate-100">
                         ${p.image ? `<img src="${p.image}" class="w-full h-full object-cover group-hover:opacity-80 transition-opacity">` : ''}
                    </div>
                    <div>
                        <h5 class="text-sm font-bold text-slate-800 leading-snug group-hover:text-blue-600 transition-colors line-clamp-2 font-display">${p.title}</h5>
                        <span class="text-xs text-slate-400 mt-1 block">${p.date}</span>
                    </div>
                </a>
             `).join('');
        }
        
        // Search
        document.getElementById('search-input').addEventListener('input', (e) => {
            const t = e.target.value.toLowerCase();
            filteredPosts = allPosts.filter(p => p.title.toLowerCase().includes(t) || (p.category && p.category.toLowerCase().includes(t)));
            currentPage = 1;
            singleView.classList.add('hidden');
            listView.classList.remove('hidden');
            renderPaginatedList();
        });

        init();
    </script>
</body>
</html>
